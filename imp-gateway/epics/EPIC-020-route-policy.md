# EPIC-020: Gateway Service Configuration (Routes, Backends, Policies)

## ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **Epic ID** | EPIC-020 |
| **ì œëª©** | Gateway Service Configuration |
| **ìš°ì„ ìˆœìœ„** | P0 (EPIC-016ê³¼ í•¨ê»˜ ë˜ëŠ” ì§í›„ êµ¬í˜„ ê¶Œì¥) |
| **ì˜ˆìƒ ê¸°ê°„** | 2ì£¼ |
| **ìƒíƒœ** | âœ… ì™„ë£Œ |
| **ì˜ì¡´ì„±** | EPIC-016 (API Service) |

> âš ï¸ **êµ¬í˜„ ìˆœì„œ ì°¸ê³ **: EPIC-016(API Service)ê³¼ ë³¸ EPIC(Route/Backend/Policy)ëŠ” ë°€ì ‘í•˜ê²Œ ì—°ê´€ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
> EPIC-016ì—ì„œ API Service ìƒì„¸ í˜ì´ì§€ë¥¼ êµ¬í˜„í•  ë•Œ Routes/Backends/Policies ëª©ë¡ì„ ì½ê¸° ì „ìš©ìœ¼ë¡œ í‘œì‹œí•˜ê³ ,
> ë³¸ EPICì—ì„œ CRUD ê¸°ëŠ¥ì„ ì¶”ê°€í•©ë‹ˆë‹¤. **ë³‘ë ¬ ë˜ëŠ” ì—°ì† êµ¬í˜„ì„ ê¶Œì¥**í•©ë‹ˆë‹¤.

## ëª©í‘œ

Providerê°€ Kong Konnect ìŠ¤íƒ€ì¼ì˜ ì§ê´€ì ì¸ UIë¡œ Envoy Gatewayì˜ ëª¨ë“  ê¸°ëŠ¥ì„ ì„¸ë°€í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

## ë°°ê²½

### Kong Konnect ì•„í‚¤í…ì²˜ ì°¸ì¡°

Kong Gatewayì˜ í•µì‹¬ ê°œë…ì„ ì°¸ì¡°í•˜ë˜, **Policy** ìš©ì–´ë¥¼ ì‚¬ìš©:
- **Gateway Service**: Upstream ì„œë¹„ìŠ¤ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë…¼ë¦¬ì  ì—”í‹°í‹° (â‰ˆ API Service)
- **Route**: ìš”ì²­ì„ Serviceë¡œ ë¼ìš°íŒ…í•˜ëŠ” ê·œì¹™
- **Policy**: ì¸ì¦, Rate Limiting, CORS ë“± ì •ì±…ì„ ì ìš©í•˜ëŠ” í™•ì¥ (Kongì˜ Pluginì— í•´ë‹¹)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        imprun Gateway Architecture                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   Client Request                                                        â”‚
â”‚        â”‚                                                                â”‚
â”‚        â–¼                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚  Route  â”‚ â”€â”€â–¶ â”‚ Policy  â”‚ â”€â”€â–¶ â”‚ Policy  â”‚ â”€â”€â–¶ â”‚   Backend   â”‚      â”‚
â”‚   â”‚ (Match) â”‚     â”‚ (Auth)  â”‚     â”‚ (Rate)  â”‚     â”‚  (Upstream) â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                         â”‚
â”‚   Policies can attach to:                                               â”‚
â”‚   â€¢ Global (all requests)                                               â”‚
â”‚   â€¢ Service (all routes of a service)                                   â”‚
â”‚   â€¢ Route (specific route only)                                         â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Envoy Gateway ê¸°ëŠ¥ ë§¤í•‘

| Kong Konnect | Envoy Gateway | imprun ëª¨ë¸ |
|--------------|---------------|-------------|
| Gateway Service | Backend + HTTPRoute | APIService + Backend |
| Route | HTTPRoute.rules | Route |
| Plugin (Auth) | SecurityPolicy | Policy (category: security) |
| Plugin (Traffic) | BackendTrafficPolicy | Policy (category: traffic) |
| Plugin (Client) | ClientTrafficPolicy | Policy (category: client) |

### Envoy Gateway ì§€ì› ì •ì±… ëª©ë¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Envoy Gateway Policy Types                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SecurityPolicy (ì¸ì¦/ì¸ê°€) - âš ï¸ Product Publishì—ì„œ ì„¤ì •          â”‚   â”‚
â”‚  â”‚ â€¢ JWT Authentication    â€¢ API Key Auth      â€¢ Basic Auth        â”‚   â”‚
â”‚  â”‚ â€¢ OAuth2/OIDC           â€¢ External Auth                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SecurityPolicy (CORS) - âœ… EPIC-020 ë²”ìœ„                          â”‚   â”‚
â”‚  â”‚ â€¢ CORS Headers                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ BackendTrafficPolicy (ë°±ì—”ë“œ íŠ¸ë˜í”½) - âœ… EPIC-020 ë²”ìœ„           â”‚   â”‚
â”‚  â”‚ â€¢ Rate Limiting         â€¢ Circuit Breaker   â€¢ Retry Policy      â”‚   â”‚
â”‚  â”‚ â€¢ Timeout               â€¢ Load Balancer     â€¢ Health Check      â”‚   â”‚
â”‚  â”‚ â€¢ Compression           â€¢ Fault Injection   â€¢ Connection Pool   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ClientTrafficPolicy (í´ë¼ì´ì–¸íŠ¸ íŠ¸ë˜í”½) - âœ… EPIC-020 ë²”ìœ„        â”‚   â”‚
â”‚  â”‚ â€¢ TLS Settings          â€¢ HTTP/2/3 Config   â€¢ Proxy Protocol    â”‚   â”‚
â”‚  â”‚ â€¢ Connection Limit      â€¢ IP Detection      â€¢ Header Settings   â”‚   â”‚
â”‚  â”‚ â€¢ Request Timeout                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ HTTPRouteFilter (ìš”ì²­/ì‘ë‹µ ë³€í™˜) - âœ… EPIC-020 ë²”ìœ„               â”‚   â”‚
â”‚  â”‚ â€¢ URL Rewrite           â€¢ Header Modifier   â€¢ Request Redirect  â”‚   â”‚
â”‚  â”‚ â€¢ Request Mirror        â€¢ Direct Response                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> âš ï¸ **ì¸ì¦ ì •ì±… ë¶„ë¦¬**: JWT, API Key, Basic Auth, OAuth2, External Auth ë“± **ì¸ì¦ ê´€ë ¨ ì •ì±…ì€ Product Publish ì‹œì **ì— ì„¤ì •í•©ë‹ˆë‹¤.
> EPIC-020ì—ì„œëŠ” CORS, Rate Limit, Timeout ë“± **íŠ¸ë˜í”½ ì œì–´ ì •ì±…**ë§Œ ë‹¤ë£¹ë‹ˆë‹¤.

## ë²”ìœ„

### í¬í•¨
- Route CRUD (path matching, methods, headers, query params)
- Backend CRUD (endpoints, load balancer, health check)
- Policy CRUD (íŠ¸ë˜í”½ ì œì–´ ì •ì±…)
  - Traffic Policies (Rate Limit, Retry, Timeout, Circuit Breaker)
  - Transform Policies (Header Modifier, URL Rewrite)
  - CORS Policy
- API Service ìƒì„¸ ë‚´ Routes/Backends/Policies íƒ­
- Policy ìŠ¤ì½”í”„ ì„¤ì • (Service, Route)

### ì œì™¸
- **ì¸ì¦ ì •ì±…** (JWT, API Key, Basic Auth, OAuth2, External Auth) - Product Publishì—ì„œ ì„¤ì •
- ë™ì  Policy í¼ ë¹Œë” (Post-MVP, JSON í¸ì§‘ê¸°ë¡œ ëŒ€ì²´)
- ì‹¤ì‹œê°„ Route í…ŒìŠ¤íŠ¸ (Post-MVP)
- OpenAPI ê¸°ë°˜ ìë™ Route ìƒì„± (Post-MVP)
- EnvoyExtensionPolicy (Wasm, External Processing)

## ì•„í‚¤í…ì²˜

### ìš”ì²­ íë¦„

```mermaid
sequenceDiagram
    participant C as Client
    participant EG as Envoy Gateway
    participant R as Route Matcher
    participant SP as SecurityPolicy
    participant TP as TrafficPolicy
    participant B as Backend

    C->>EG: HTTP Request
    EG->>R: Match Route (path, method, headers)

    alt Route Matched
        R->>SP: Apply SecurityPolicy (from Product Publish)
        Note over SP: JWT/APIKey Check (ì„¤ì •ëœ ê²½ìš°)

        alt Auth Success or No Auth Required
            SP->>TP: Apply TrafficPolicy (EPIC-020)
            Note over TP: CORS, Rate Limit, Timeout
            TP->>B: Forward to Backend
            B-->>C: Response
        else Auth Failure
            SP-->>C: 401/403 Response
        end
    else No Match
        R-->>C: 404 Not Found
    end
```

> ğŸ“ **ì°¸ê³ **: SecurityPolicy(ì¸ì¦)ëŠ” Product Publishì—ì„œ ì„¤ì •ë˜ë©°, EPIC-020ì—ì„œ ì„¤ì •í•˜ëŠ” TrafficPolicyëŠ” ì¸ì¦ ì´í›„ ë‹¨ê³„ì—ì„œ ì ìš©ë©ë‹ˆë‹¤.

### Policy ì ìš© ìš°ì„ ìˆœìœ„

```mermaid
flowchart TD
    subgraph Scope["Policy Scope Hierarchy"]
        G[Global Policy]
        S[Service Policy]
        R[Route Policy]
    end

    G --> S
    S --> R

    subgraph Priority["Evaluation Order"]
        P1["1. Route-specific policies (highest priority)"]
        P2["2. Service-level policies"]
        P3["3. Global policies (lowest priority)"]
    end

    R -.-> P1
    S -.-> P2
    G -.-> P3
```

### ìƒíƒœ íë¦„

```mermaid
stateDiagram-v2
    [*] --> Draft: Create Route/Backend/Policy

    Draft --> Active: Activate
    Draft --> Draft: Edit

    Active --> Inactive: Deactivate
    Active --> Active: Update Config

    Inactive --> Active: Activate
    Inactive --> Deleted: Delete

    Draft --> Deleted: Delete

    Deleted --> [*]

    note right of Active: Traffic is routed
    note right of Inactive: Config preserved, no traffic
    note right of Draft: Not deployed yet
```

## ê¸°ìˆ  ìš”êµ¬ì‚¬í•­

### ë°±ì—”ë“œ API

```
# Routes (HTTPRoute ë§¤í•‘)
GET    /api/v1/provider/api-services/:id/routes
POST   /api/v1/provider/api-services/:id/routes
GET    /api/v1/provider/routes/:id
PUT    /api/v1/provider/routes/:id
DELETE /api/v1/provider/routes/:id

# Backends (Upstream ì„œë²„)
GET    /api/v1/provider/api-services/:id/backends
POST   /api/v1/provider/api-services/:id/backends
GET    /api/v1/provider/backends/:id
PUT    /api/v1/provider/backends/:id
DELETE /api/v1/provider/backends/:id

# Policies
GET    /api/v1/provider/policies                    # Global policies
GET    /api/v1/provider/api-services/:id/policies   # Service policies
GET    /api/v1/provider/routes/:id/policies         # Route policies
POST   /api/v1/provider/policies                    # Create policy
GET    /api/v1/provider/policies/:id
PUT    /api/v1/provider/policies/:id
DELETE /api/v1/provider/policies/:id
```

### ë°ì´í„° ëª¨ë¸

```typescript
// Route - HTTPRoute ë§¤í•‘
interface Route {
  id: string;
  api_service_id: string;
  name: string;

  // Matching
  hostnames?: string[];
  path_prefix?: string;
  path_regex?: string;
  path_exact?: string;
  methods?: ('GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH' | 'HEAD' | 'OPTIONS')[];
  headers?: RouteHeaderMatch[];
  query_params?: RouteQueryMatch[];

  // Routing
  backend_refs: BackendRef[];

  // Metadata
  priority: number;
  tags?: Record<string, string>;
  status: 'active' | 'inactive' | 'draft';

  // Advanced (HTTPRoute timeouts)
  timeouts?: {
    request?: string;      // e.g., "30s"
    backend_request?: string;
  };

  created_at: string;
  updated_at: string;
}

interface RouteHeaderMatch {
  name: string;
  type: 'Exact' | 'RegularExpression' | 'Present';
  value?: string;
}

interface RouteQueryMatch {
  name: string;
  type: 'Exact' | 'RegularExpression';
  value: string;
}

interface BackendRef {
  backend_id: string;
  weight?: number;  // for traffic splitting
}

// Backend - Envoy Gateway Backend ë§¤í•‘
interface Backend {
  id: string;
  api_service_id: string;
  name: string;

  // Endpoints
  scheme: 'http' | 'https' | 'grpc' | 'grpcs';
  endpoints: BackendEndpoint[];

  // Load Balancing
  lb_policy: 'RoundRobin' | 'LeastRequest' | 'Random' | 'ConsistentHash';
  consistent_hash?: {
    type: 'SourceIP' | 'Header' | 'Cookie';
    header_name?: string;
    cookie?: { name: string; ttl?: string };
  };

  // Connection
  timeout_ms?: number;
  connect_timeout_ms?: number;
  idle_timeout_ms?: number;

  // Health Check
  health_check?: {
    type: 'HTTP' | 'TCP' | 'GRPC';
    interval: string;
    timeout: string;
    unhealthy_threshold: number;
    healthy_threshold: number;
    http?: { path: string; expected_statuses?: number[] };
  };

  // Circuit Breaker
  circuit_breaker?: {
    max_connections?: number;
    max_pending_requests?: number;
    max_requests?: number;
    max_retries?: number;
  };

  // TLS
  tls?: {
    sni?: string;
    insecure_skip_verify?: boolean;
  };

  // Retry
  retry?: {
    num_retries: number;
    retry_on: string[];  // '5xx', 'reset', 'connect-failure'
    per_try_timeout?: string;
  };

  status: 'active' | 'inactive';
  created_at: string;
  updated_at: string;
}

interface BackendEndpoint {
  host: string;
  port: number;
  weight?: number;
  zone?: string;
}

// Policy (Envoy Gateway Policy ë§¤í•‘)
interface Policy {
  id: string;
  name: string;  // e.g., 'rate-limit', 'jwt-auth', 'cors'

  // Scope
  scope: 'global' | 'service' | 'route';
  api_service_id?: string;  // when scope is 'service'
  route_id?: string;        // when scope is 'route'

  // Policy Type Category
  category: 'security' | 'traffic' | 'transform' | 'observability';

  // Policy Type (maps to Envoy Gateway policy type)
  type: string;  // 'jwt-auth', 'api-key-auth', 'rate-limit', 'cors', etc.

  // Configuration (JSON)
  spec: Record<string, any>;

  // Ordering
  priority?: number;

  enabled: boolean;
  created_at: string;
  updated_at: string;
}

// Policy íƒ€ì…ë³„ Spec ìŠ¤í‚¤ë§ˆ
interface RateLimitSpec {
  requests_per_unit: number;
  unit: 'second' | 'minute' | 'hour' | 'day';
  burst?: number;
}

interface JWTAuthSpec {
  issuer: string;
  audiences?: string[];
  jwks_uri?: string;
  local_jwks?: string;
  claim_to_headers?: { header: string; claim: string }[];
}

interface CORSSpec {
  allow_origins: string[];
  allow_methods: string[];
  allow_headers: string[];
  expose_headers?: string[];
  max_age?: number;
  allow_credentials?: boolean;
}

interface APIKeyAuthSpec {
  key_names: string[];  // header/query param names
  hide_credentials?: boolean;
}

interface RetrySpec {
  num_retries: number;
  retry_on: string[];
  per_try_timeout?: string;
  backoff?: { base_interval: string; max_interval: string };
}

interface CircuitBreakerSpec {
  max_connections: number;
  max_pending_requests: number;
  max_requests: number;
  max_retries: number;
}

interface TimeoutSpec {
  request_timeout: string;
  idle_timeout?: string;
}

interface HeaderModifierSpec {
  add?: { name: string; value: string }[];
  set?: { name: string; value: string }[];
  remove?: string[];
}

interface URLRewriteSpec {
  hostname?: string;
  path?: {
    type: 'ReplacePrefixMatch' | 'ReplaceFullPath';
    value: string;
  };
}
```

### FSD êµ¬ì¡°

```
web/src/
â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ route/
â”‚   â”‚   â”œâ”€â”€ model/types.ts
â”‚   â”‚   â”œâ”€â”€ api/route-api.ts
â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚       â”œâ”€â”€ route-status-badge.tsx
â”‚   â”‚       â”œâ”€â”€ route-method-tags.tsx
â”‚   â”‚       â””â”€â”€ route-path-display.tsx
â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”œâ”€â”€ model/types.ts
â”‚   â”‚   â”œâ”€â”€ api/backend-api.ts
â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚       â”œâ”€â”€ backend-status-badge.tsx
â”‚   â”‚       â”œâ”€â”€ backend-scheme-tag.tsx
â”‚   â”‚       â””â”€â”€ backend-endpoints-list.tsx
â”‚   â””â”€â”€ policy/
â”‚       â”œâ”€â”€ model/types.ts
â”‚       â”œâ”€â”€ api/policy-api.ts
â”‚       â”œâ”€â”€ lib/
â”‚       â”‚   â”œâ”€â”€ policy-registry.ts    # ì •ì±… ë©”íƒ€ë°ì´í„°
â”‚       â”‚   â””â”€â”€ policy-schemas.ts     # JSON Schema per policy type
â”‚       â””â”€â”€ ui/
â”‚           â”œâ”€â”€ policy-card.tsx
â”‚           â”œâ”€â”€ policy-category-badge.tsx
â”‚           â””â”€â”€ policy-scope-indicator.tsx
â”‚
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ route/
â”‚   â”‚   â”œâ”€â”€ create-route/
â”‚   â”‚   â”œâ”€â”€ update-route/
â”‚   â”‚   â””â”€â”€ delete-route/
â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”œâ”€â”€ create-backend/
â”‚   â”‚   â”œâ”€â”€ update-backend/
â”‚   â”‚   â””â”€â”€ delete-backend/
â”‚   â””â”€â”€ policy/
â”‚       â”œâ”€â”€ create-policy/
â”‚       â”‚   â””â”€â”€ ui/
â”‚       â”‚       â”œâ”€â”€ policy-type-selector.tsx
â”‚       â”‚       â”œâ”€â”€ policy-spec-editor.tsx  # JSON Editor
â”‚       â”‚       â””â”€â”€ create-policy-form.tsx
â”‚       â”œâ”€â”€ update-policy/
â”‚       â””â”€â”€ delete-policy/
â”‚
â”œâ”€â”€ widgets/
â”‚   â””â”€â”€ provider/
â”‚       â”œâ”€â”€ routes-table/
â”‚       â”œâ”€â”€ backends-table/
â”‚       â”œâ”€â”€ policies-list/
â”‚       â”‚   â””â”€â”€ ui/
â”‚       â”‚       â”œâ”€â”€ policies-by-category.tsx
â”‚       â”‚       â””â”€â”€ policy-quick-enable.tsx
â”‚       â””â”€â”€ traffic-flow-diagram/     # ì‹œê°ì  íŠ¸ë˜í”½ íë¦„
â”‚           â””â”€â”€ index.tsx
â”‚
â””â”€â”€ pages/provider/
    â”œâ”€â”€ routes-page.tsx               # Standalone routes list
    â”œâ”€â”€ route-detail-page.tsx
    â”œâ”€â”€ backends-page.tsx
    â”œâ”€â”€ backend-detail-page.tsx
    â”œâ”€â”€ policies-page.tsx             # Global policies
    â””â”€â”€ policy-detail-page.tsx
```

## UI/UX ì„¤ê³„

### Kong Konnect ìŠ¤íƒ€ì¼ ë„¤ë¹„ê²Œì´ì…˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Provider Portal                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Gateway Manager â”‚  â”‚                                             â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  API Services > payment-api                 â”‚  â”‚
â”‚  â”‚ â”œâ”€ Dashboard    â”‚  â”‚                                             â”‚  â”‚
â”‚  â”‚ â”œâ”€ API Services â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚  â”‚ â”‚   â””â”€ Routes   â”‚  â”‚  â”‚ Overview â”‚ Routes â”‚ Backends â”‚ Policiesâ”‚â”‚  â”‚
â”‚  â”‚ â”‚   â””â”€ Backends â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚  â”‚ â”‚   â””â”€ Policies â”‚  â”‚                                             â”‚  â”‚
â”‚  â”‚ â”œâ”€ Gateways     â”‚  â”‚  Routes (3)                    [+ Add Route]â”‚  â”‚
â”‚  â”‚ â””â”€ Global       â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚  â”‚     Policies    â”‚  â”‚  â”‚ Name         Path         Methods   BE  â”‚â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ get-users    /users       GET      api  â”‚â”‚  â”‚
â”‚                       â”‚  â”‚ create-user  /users       POST     api  â”‚â”‚  â”‚
â”‚                       â”‚  â”‚ get-user     /users/:id   GET      api  â”‚â”‚  â”‚
â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚                       â”‚                                             â”‚  â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Route ìƒì„¸ í˜ì´ì§€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Route: get-users                                    [Edit] [Delete]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Status: â— Active       Priority: 100       Created: 2024-01-15        â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Matching Rules                                                   â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚ Path:      /api/v1/users                  (Prefix Match)        â”‚   â”‚
â”‚  â”‚ Methods:   GET                                                   â”‚   â”‚
â”‚  â”‚ Headers:   X-API-Version: v1              (Exact Match)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Backend Target                                                   â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚   â”‚
â”‚  â”‚ â”‚ user-api-backend      â”‚ Weight: 100%                          â”‚   â”‚
â”‚  â”‚ â”‚ https â€¢ 2 endpoints   â”‚                                        â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Applied Policies                                [+ Add Policy]   â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚ â”‚ âš¡ Rate Limitâ”‚ â”‚ ğŸŒ CORS      â”‚ â”‚ ğŸ”„ Header    â”‚              â”‚   â”‚
â”‚  â”‚ â”‚ Route scope  â”‚ â”‚ Service scopeâ”‚ â”‚ Modifier     â”‚              â”‚   â”‚
â”‚  â”‚ â”‚ â— Enabled    â”‚ â”‚ â— Enabled    â”‚ â”‚ â— Enabled    â”‚              â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚ â„¹ï¸ ì¸ì¦ ì •ì±…ì€ Product Publishì—ì„œ ì„¤ì •ë©ë‹ˆë‹¤                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Policy ìƒì„± Wizard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Add Policy                                                     [Ã—]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Step 1: Select Policy Type                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                         â”‚
â”‚  ğŸŒ CORS                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚  â”‚ CORS       â”‚                                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚                                                                         â”‚
â”‚  âš¡ Traffic Control                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Rate Limit â”‚ â”‚ Retry      â”‚ â”‚ Timeout    â”‚ â”‚ Circuit    â”‚           â”‚
â”‚  â”‚            â”‚ â”‚            â”‚ â”‚            â”‚ â”‚ Breaker    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                         â”‚
â”‚  ğŸ”„ Request/Response Transform                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ Header     â”‚ â”‚ URL        â”‚ â”‚ Request    â”‚                          â”‚
â”‚  â”‚ Modifier   â”‚ â”‚ Rewrite    â”‚ â”‚ Redirect   â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â„¹ï¸ ì¸ì¦ ì •ì±… (JWT, API Key ë“±)ì€ Product Publishì—ì„œ ì„¤ì •í•©ë‹ˆë‹¤.       â”‚
â”‚                                                                         â”‚
â”‚                                              [Cancel] [Next â†’]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Policy ì„¤ì • í¼ (Rate Limit ì˜ˆì‹œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Configure: Rate Limiting                                       [Ã—]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Scope                                                                  â”‚
â”‚  â—‹ Global (all routes)                                                  â”‚
â”‚  â—‹ Service: [payment-api â–¼]                                             â”‚
â”‚  â— Route: [get-users â–¼]                                                 â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                         â”‚
â”‚  Configuration                                                          â”‚
â”‚                                                                         â”‚
â”‚  Requests per unit: [100        ]                                       â”‚
â”‚                                                                         â”‚
â”‚  Time unit:  â—‹ Second  â— Minute  â—‹ Hour  â—‹ Day                         â”‚
â”‚                                                                         â”‚
â”‚  Burst (optional): [10         ]                                        â”‚
â”‚  â””â”€ Allow temporary spike above limit                                   â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                         â”‚
â”‚  Advanced (JSON)                                          [â–¼ Expand]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ {                                                                â”‚   â”‚
â”‚  â”‚   "requests_per_unit": 100,                                      â”‚   â”‚
â”‚  â”‚   "unit": "minute",                                              â”‚   â”‚
â”‚  â”‚   "burst": 10                                                    â”‚   â”‚
â”‚  â”‚ }                                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â–¡ Enable this policy                                                   â”‚
â”‚                                                                         â”‚
â”‚                                              [Cancel] [Save Policy]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Policy ì„¤ì • í¼ (Header Modifier ì˜ˆì‹œ - ì™¸ë¶€ API ì—°ë™)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Configure: Header Modifier                                       [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Scope                                                                  â”‚
â”‚  â—‹ Global (all routes)                                                  â”‚
â”‚  â—‹ Service: [openai-proxy â–¼]                                            â”‚
â”‚  â— Route: [chat-completions â–¼]                                          â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                         â”‚
â”‚  Use Case Template (optional)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ OpenAI       â”‚ â”‚ Stripe       â”‚ â”‚ AWS API GW   â”‚ â”‚ Custom       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                         â”‚
â”‚  Headers to Add                                        [+ Add Header]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Authorization      â”‚ Bearer sk-proj-xxxxx          â”‚    [Ã—]     â”‚   â”‚
â”‚  â”‚ OpenAI-Organizationâ”‚ org-xxxxx                     â”‚    [Ã—]     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Headers to Set (overwrite existing)                   [+ Add Header]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Content-Type       â”‚ application/json               â”‚    [Ã—]     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Headers to Remove                                     [+ Add Header]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ X-Internal-Request-Id                               â”‚    [Ã—]     â”‚   â”‚
â”‚  â”‚ X-Debug-Mode                                        â”‚    [Ã—]     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                         â”‚
â”‚  âš ï¸ Security Note: API keys stored here will be visible in the         â”‚
â”‚  configuration. Consider using Kubernetes Secrets for sensitive values. â”‚
â”‚                                                                         â”‚
â”‚  â–¡ Enable this policy                                                   â”‚
â”‚                                                                         â”‚
â”‚                                              [Cancel] [Save Policy]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Backend ìƒì„¸ í˜ì´ì§€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend: user-api-backend                           [Edit] [Delete]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Status: â— Active       Scheme: HTTPS       Created: 2024-01-15        â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Endpoints                                        [+ Add Endpoint]â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚ â”‚ api-1.example.com:443    Weight: 50%    Zone: us-east-1   â”‚   â”‚   â”‚
â”‚  â”‚ â”‚ â— Healthy (last check: 5s ago)                             â”‚   â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚ â”‚ api-2.example.com:443    Weight: 50%    Zone: us-west-2   â”‚   â”‚   â”‚
â”‚  â”‚ â”‚ â— Healthy (last check: 3s ago)                             â”‚   â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Load Balancing                                                   â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚ Algorithm: Round Robin                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Health Check                                                     â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚ Type: HTTP    Path: /health    Interval: 10s                    â”‚   â”‚
â”‚  â”‚ Healthy threshold: 2    Unhealthy threshold: 3                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Connection Settings                                              â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚ Connect Timeout: 10s    Request Timeout: 30s    Idle: 60s       â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚ Circuit Breaker: â— Enabled                                       â”‚   â”‚
â”‚  â”‚ Max Connections: 1024    Max Pending: 1024    Max Retries: 3    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Used by Routes                                                   â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚ â€¢ get-users (/users, GET)                                        â”‚   â”‚
â”‚  â”‚ â€¢ create-user (/users, POST)                                     â”‚   â”‚
â”‚  â”‚ â€¢ get-user (/users/:id, GET)                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ìŠ¤í† ë¦¬ ë¶„í•´

| Story | ì œëª© | ì˜ˆìƒ | ìš°ì„ ìˆœìœ„ |
|-------|------|------|----------|
| 20.1 | Route ì—”í‹°í‹° ë° API í›… êµ¬í˜„ | 0.5ì¼ | P0 |
| 20.2 | Backend ì—”í‹°í‹° ë° API í›… êµ¬í˜„ | 0.5ì¼ | P0 |
| 20.3 | Policy ì—”í‹°í‹° ë° API í›… êµ¬í˜„ | 0.5ì¼ | P0 |
| 20.4 | API Service ìƒì„¸ íƒ­ UI (Routes/Backends/Policies) | 1ì¼ | P0 |
| 20.5 | Route CRUD UI (Path/Method/Header Matching) | 1.5ì¼ | P0 |
| 20.6 | Backend CRUD UI (Endpoints, LB, Health Check) | 1.5ì¼ | P0 |
| 20.7 | Policy Type Selector ë° Category UI | 1ì¼ | P0 |
| 20.8 | Policy Configuration Editor (JSON + ê¸°ë³¸ í¼) | 1.5ì¼ | P0 |
| 20.9 | Route-Backend ì—°ê²° ë° Traffic Splitting UI | 0.5ì¼ | P1 |
| 20.10 | Policy Scope ì„¤ì • (Global/Service/Route) | 0.5ì¼ | P0 |

**ì´ ì˜ˆìƒ ê³µìˆ˜**: 9ì¼ (ì•½ 2ì£¼)

## ìˆ˜ìš© ê¸°ì¤€

### ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­
- [ ] Routeë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤ (path, method, header matching)
- [ ] Routeì— ì—¬ëŸ¬ Backendë¥¼ ì—°ê²°í•˜ê³  weightë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
- [ ] Backendë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤ (endpoints, load balancer, health check)
- [ ] Policyë¥¼ ìƒì„±í•˜ê³  scopeë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤ (service/route)
- [ ] CORS policyë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
- [ ] Traffic policies (Rate Limit, Timeout, Retry, Circuit Breaker)ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
- [ ] Transform policies (Header Modifier, URL Rewrite)ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
- [ ] Policyë¥¼ í™œì„±í™”/ë¹„í™œì„±í™”í•  ìˆ˜ ìˆë‹¤
- [ ] API Service ìƒì„¸ì—ì„œ Routes/Backends/Policiesë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­
- [ ] Policy ì„¤ì • JSON ìŠ¤í‚¤ë§ˆ ê²€ì¦
- [ ] í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì¦
- [ ] ì‚­ì œ ì‹œ ì˜ì¡´ì„± ê²½ê³  (Route ì‚­ì œ ì‹œ ì—°ê²°ëœ Policy ê²½ê³ )
- [ ] Policy íƒ€ì…ë³„ ê¸°ë³¸ í…œí”Œë¦¿ ì œê³µ

## Policy ëª©ë¡ (MVP)

### CORS Policy
| Policy Type | Envoy Gateway | ì„¤ëª… |
|-------------|---------------|------|
| cors | SecurityPolicy.cors | CORS í—¤ë” ì„¤ì • |

### Traffic Policies
| Policy Type | Envoy Gateway | ì„¤ëª… |
|-------------|---------------|------|
| rate-limit | BackendTrafficPolicy.rateLimit | ìš”ì²­ ì†ë„ ì œí•œ |
| retry | BackendTrafficPolicy.retry | ì¬ì‹œë„ ì •ì±… |
| timeout | BackendTrafficPolicy.timeout | ìš”ì²­ íƒ€ì„ì•„ì›ƒ |
| circuit-breaker | BackendTrafficPolicy.circuitBreaker | ì„œí‚· ë¸Œë ˆì´ì»¤ |

### Transform Policies
| Policy Type | Envoy Gateway | ì„¤ëª… |
|-------------|---------------|------|
| header-modifier | HTTPRoute.filters | í—¤ë” ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ |
| url-rewrite | HTTPRoute.filters | URL ì¬ì‘ì„± |

### ì™¸ë¶€ API ì—°ë™ ì‹œë‚˜ë¦¬ì˜¤ (Header Modifier í™œìš©)

ì™¸ë¶€ ìƒìš© API ì„œë¹„ìŠ¤(OpenAI, Stripe, AWS ë“±)ë¥¼ Backendë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, **Header Modifier**ë¥¼ í†µí•´ ì¸ì¦ í—¤ë”ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   External API Integration Flow                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   Client Request                                                        â”‚
â”‚   (No API Key)                                                          â”‚
â”‚        â”‚                                                                â”‚
â”‚        â–¼                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Envoy Gateway                                                    â”‚   â”‚
â”‚   â”‚                                                                  â”‚   â”‚
â”‚   â”‚   1. Route Match: /api/openai/*                                  â”‚   â”‚
â”‚   â”‚   2. Apply Header Modifier Policy:                               â”‚   â”‚
â”‚   â”‚      + Authorization: Bearer sk-xxxxx                            â”‚   â”‚
â”‚   â”‚      + x-api-key: key-xxxxx                                      â”‚   â”‚
â”‚   â”‚      - X-Internal-Header (remove)                                â”‚   â”‚
â”‚   â”‚                                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â–¼                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ External API Backend                                             â”‚   â”‚
â”‚   â”‚ (OpenAI, Stripe, AWS, etc.)                                      â”‚   â”‚
â”‚   â”‚                                                                  â”‚   â”‚
â”‚   â”‚ Receives request with:                                           â”‚   â”‚
â”‚   â”‚ â€¢ Authorization: Bearer sk-xxxxx                                 â”‚   â”‚
â”‚   â”‚ â€¢ x-api-key: key-xxxxx                                           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‚¬ìš© ì‚¬ë¡€:**
| ì™¸ë¶€ ì„œë¹„ìŠ¤ | í•„ìš”í•œ í—¤ë” | Header Modifier ì„¤ì • |
|------------|------------|---------------------|
| OpenAI | `Authorization: Bearer sk-xxx` | add: Authorization |
| Stripe | `Authorization: Bearer sk_xxx` | add: Authorization |
| AWS API Gateway | `x-api-key: xxx` | add: x-api-key |
| Azure OpenAI | `api-key: xxx` | add: api-key |
| Custom API | `X-Custom-Auth: token` | add: X-Custom-Auth |

**Envoy Gateway HTTPRoute ì„¤ì • ì˜ˆì‹œ:**
```yaml
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: openai-proxy-route
spec:
  parentRefs:
  - name: api-gateway
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /api/openai
    filters:
    - type: RequestHeaderModifier
      requestHeaderModifier:
        add:
        - name: Authorization
          value: "Bearer sk-proj-xxxxxxxxxxxxxxxx"
        - name: OpenAI-Organization
          value: "org-xxxxxxxx"
        remove:
        - X-Internal-Request-Id
    - type: URLRewrite
      urlRewrite:
        path:
          type: ReplacePrefixMatch
          replacePrefixMatch: /v1
    backendRefs:
    - name: openai-backend
      port: 443
```

> âš ï¸ **ë³´ì•ˆ ì£¼ì˜ì‚¬í•­**: API í‚¤ì™€ ê°™ì€ ë¯¼ê°í•œ ì •ë³´ëŠ” Kubernetes Secretìœ¼ë¡œ ê´€ë¦¬í•˜ê³ , í™˜ê²½ë³€ìˆ˜ë‚˜ SecretRefë¥¼ í†µí•´ ì°¸ì¡°í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. ì§ì ‘ ê°’ì„ í•˜ë“œì½”ë”©í•˜ì§€ ë§ˆì„¸ìš”.

### ì¸ì¦ ì •ì±… (Product Publishì—ì„œ ì„¤ì •)

> âš ï¸ ì•„ë˜ ì •ì±…ë“¤ì€ **EPIC-020 ë²”ìœ„ì—ì„œ ì œì™¸**ë©ë‹ˆë‹¤. Product Publish ì‹œì ì— ì„¤ì •í•©ë‹ˆë‹¤.

| Policy Type | Envoy Gateway | ì„¤ëª… |
|-------------|---------------|------|
| jwt-auth | SecurityPolicy.jwt | JWT í† í° ê²€ì¦ |
| api-key-auth | SecurityPolicy.apiKeyAuth | API Key ì¸ì¦ |
| basic-auth | SecurityPolicy.basicAuth | Basic ì¸ì¦ |
| oauth2 | SecurityPolicy.oidc | OAuth2/OIDC ì¸ì¦ |
| ext-auth | SecurityPolicy.extAuth | ì™¸ë¶€ ì¸ì¦ ì„œë¹„ìŠ¤ |

## ì°¸ì¡°

### íŒ¨í„´ ì°¸ì¡°
- Kong Konnect Gateway Manager UI: https://docs.konghq.com/konnect/
- Envoy Gateway Policies: https://gateway.envoyproxy.io/docs/

### ë°±ì—”ë“œ API
- `services/imprun-server/internal/api/v1/provider/routes.go`
- `services/imprun-server/internal/api/v1/provider/backends.go`
- `services/imprun-server/internal/api/v1/provider/policies.go`

### Envoy Gateway ë¬¸ì„œ
- `docs/vendor/envoy-gateway/extension_types.md`
- `docs/vendor/envoy-gateway/gateway_api/httproute.md`

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë³€ê²½ ë‚´ìš© | ì‘ì„±ì |
|------|------|----------|--------|
| 2025-01-XX | 1.0 | ì´ˆê¸° ì‘ì„± | - |
| 2025-11-27 | 1.1 | ì˜ì¡´ì„± EPIC-017â†’EPIC-016ìœ¼ë¡œ ìˆ˜ì •, ìš°ì„ ìˆœìœ„ P0ìœ¼ë¡œ ìƒí–¥ | Claude |
| 2025-11-27 | 2.0 | Kong Konnect ìŠ¤íƒ€ì¼ ì¬ì„¤ê³„, Envoy Gateway ì „ì²´ ê¸°ëŠ¥ í¬í•¨, Mermaid ë‹¤ì´ì–´ê·¸ë¨ ì¶”ê°€ | Claude |
| 2025-11-27 | 2.1 | Plugin â†’ Policy ìš©ì–´ ë³€ê²½ (API ì¼ê´€ì„±) | Claude |
| 2025-11-27 | 2.2 | ì¸ì¦ ì •ì±…(JWT, API Key ë“±) ì œì™¸ - Product Publishì—ì„œ ì„¤ì • | Claude |
| 2025-11-27 | 2.3 | ì™¸ë¶€ API ì—°ë™ ì‹œë‚˜ë¦¬ì˜¤ ì¶”ê°€ (Header Modifierë¡œ x-api-key ë“± ì¶”ê°€) | Claude |
