# EPIC-030: Account Settings

## ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **Epic ID** | EPIC-030 |
| **ì œëª©** | Account Settings (ê³„ì • ì„¤ì •) |
| **ìš°ì„ ìˆœìœ„** | P1 |
| **ì˜ˆìƒ ê¸°ê°„** | 1ì£¼ |
| **ìƒíƒœ** | âœ… ì™„ë£Œ |
| **ì˜ì¡´ì„±** | EPIC-012 (í¬í„¸ ë ˆì´ì•„ì›ƒ) |
| **GitHub Issue** | [#23](https://github.com/imprun/imp-gateway/issues/23) |

## ëª©í‘œ

ì‚¬ìš©ìê°€ ìì‹ ì˜ í”„ë¡œí•„, ì²­êµ¬ ì •ë³´, ì•Œë¦¼ ì„¤ì •, ì—°ê²°ëœ ì•± ë“±ì„ í†µí•©ëœ ì„¤ì • í˜ì´ì§€ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

## ë°°ê²½

í˜„ì¬ ì‚¬ìš©ìëŠ” ê¸°ë³¸ì ì¸ ì •ë³´ ìˆ˜ì • ì™¸ì— í†µí•©ëœ ê³„ì • ê´€ë¦¬ ê¸°ëŠ¥ì„ ì œê³µë°›ì§€ ëª»í•˜ê³  ìˆë‹¤. í”„ë¦¬ë¯¸ì—„ ì„œë¹„ìŠ¤ë¥¼ ì§€í–¥í•˜ëŠ” UI/UXì— ë§ì¶°, ì‚¬ìš©ìê°€ ìì‹ ì˜ ê³„ì • ê´€ë ¨ ì„¤ì •ì„ ì§ê´€ì ì´ê³  í¸ë¦¬í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì¤‘ì•™í™”ëœ ì„¤ì • í˜ì´ì§€ê°€ í•„ìš”í•˜ë‹¤.

> **ì°¸ê³ **: ì œê³µëœ ë””ìì¸ ì‹œì•ˆì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤í¬ í…Œë§ˆ ê¸°ë°˜ì˜ ê³ ê¸‰ìŠ¤ëŸ¬ìš´ UIë¥¼ êµ¬í˜„í•œë‹¤.

---

## UI/UX ê°€ì´ë“œ

### ë ˆì´ì•„ì›ƒ êµ¬ì¡° (GitHub Style)

ì„¤ì • í˜ì´ì§€ëŠ” **ê¸€ë¡œë²Œ í—¤ë”(App Bar)** ì•„ë˜ì— ìœ„ì¹˜í•˜ë©°, **ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”ëœ ì‚¬ì´ë“œë°”**ë¥¼ ê°€ì§„ 2ë‹¨ ë ˆì´ì•„ì›ƒìœ¼ë¡œ êµ¬ì„±ëœë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Logo]  Breadcrumbs / Settings                                     [User]  â”‚  <-- Global Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               â”‚  â”‚  Public profile                                   â”‚   â”‚
â”‚  â”‚  User Settingsâ”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚   Profile     â”‚  â”‚  Name                                             â”‚   â”‚
â”‚  â”‚   Account     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   Appearance  â”‚  â”‚  â”‚ Your name                                   â”‚  â”‚   â”‚
â”‚  â”‚   Notificati..â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚               â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  Access       â”‚  â”‚  Public email                                     â”‚   â”‚
â”‚  â”‚   Billing     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   Plans       â”‚  â”‚  â”‚ Select a verified email to display       â–¼  â”‚  â”‚   â”‚
â”‚  â”‚   Emails      â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚   Security ğŸ”— â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚               â”‚  â”‚  Bio                                              â”‚   â”‚
â”‚  â”‚  Integrations â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   Applicationsâ”‚  â”‚  â”‚ Tell us a little bit about yourself         â”‚  â”‚   â”‚
â”‚  â”‚               â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë©”ë‰´ êµ¬ì„± (GitHub Style)

1.  **User Settings**
    *   **Profile**: ê³µê°œ í”„ë¡œí•„ ì •ë³´ (ì´ë¦„, Bio, URL, ì†Œì…œ ê³„ì •)
    *   **Account**: ê³„ì • ì‚­ì œ, ì‚¬ìš©ìëª… ë³€ê²½
    *   **Appearance**: **í…Œë§ˆ ì„¤ì • (Light/Dark/System)** - `next-themes` ì‚¬ìš©
    *   **Notifications**: ì•Œë¦¼ ìˆ˜ì‹  ì„¤ì • (UI Only)

2.  **Access**
    *   **Billing & Plans**: ê²°ì œ ìˆ˜ë‹¨, êµ¬ë… í”Œëœ ê´€ë¦¬ (UI Only)
    *   **Emails**: ì´ë©”ì¼ ì£¼ì†Œ ê´€ë¦¬ (UI Only)
    *   **Security**: ğŸ”— **Keycloak Account Consoleë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸** (ë¹„ë°€ë²ˆí˜¸, 2FA, ì„¸ì…˜ ê´€ë¦¬)

3.  **Integrations**
    *   **Applications**: ì—°ë™ëœ ì™¸ë¶€ ì•± ê´€ë¦¬ (UI Only)

---

## Keycloak ì—°ë™

> **ì¤‘ìš”**: ì¸ì¦ ê´€ë ¨ ì„¤ì •(ë¹„ë°€ë²ˆí˜¸, 2FA, ì„¸ì…˜)ì€ Keycloakì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤.

### Security ì„¹ì…˜ ì²˜ë¦¬

Password & Authentication ëŒ€ì‹  **Security** ë©”ë‰´ë¥¼ ì œê³µí•˜ë©°, Keycloak Account Consoleë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•©ë‹ˆë‹¤.

```typescript
// Security ë©”ë‰´ í´ë¦­ ì‹œ
const KC_ISSUER = process.env.NEXT_PUBLIC_KC_ISSUER;
const accountUrl = `${KC_ISSUER}/account/#/security/signingin`;
window.open(accountUrl, '_blank');
```

### Keycloak Account Console ê¸°ëŠ¥
- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
- 2ë‹¨ê³„ ì¸ì¦(2FA) ì„¤ì •
- í™œì„± ì„¸ì…˜ ê´€ë¦¬
- ì—°ë™ëœ ì†Œì…œ ê³„ì • ê´€ë¦¬

---

## ì‚¬ìš©ì íë¦„

```mermaid
sequenceDiagram
    autonumber
    actor User
    participant Nav as User Dropdown
    participant Settings as ì„¤ì • í˜ì´ì§€
    participant API as imprun-server
    participant KC as Keycloak

    User->>Nav: í”„ë¡œí•„ í´ë¦­ -> Settings ì„ íƒ
    Nav->>Settings: /settings (ê¸°ë³¸: Profile) ì´ë™

    rect rgb(30, 30, 30)
        note right of Settings: í”„ë¡œí•„ ìˆ˜ì •
        User->>Settings: ì •ë³´ ì…ë ¥ í›„ "Save Changes" í´ë¦­
        Settings->>API: PUT /api/v1/auth/me
        API-->>Settings: ì„±ê³µ ì‘ë‹µ
        Settings-->>User: í† ìŠ¤íŠ¸ ë©”ì‹œì§€ (Success)
    end

    rect rgb(30, 30, 30)
        note right of Settings: í…Œë§ˆ ë³€ê²½
        User->>Settings: "Appearance" í´ë¦­
        Settings->>Settings: /settings/appearance ì´ë™
        User->>Settings: Dark í…Œë§ˆ ì„ íƒ
        Settings->>Settings: localStorageì— ì €ì¥, ì¦‰ì‹œ ë°˜ì˜
    end

    rect rgb(30, 30, 30)
        note right of Settings: ë³´ì•ˆ ì„¤ì •
        User->>Settings: "Security" í´ë¦­
        Settings->>KC: Keycloak Account Console ìƒˆ íƒ­ ì—´ê¸°
        KC-->>User: ë¹„ë°€ë²ˆí˜¸/2FA ì„¤ì • í˜ì´ì§€
    end
```

---

## ë²”ìœ„

### í¬í•¨
- `/settings` ë¼ìš°íŠ¸ ë° í•˜ìœ„ í˜ì´ì§€ êµ¬í˜„
- ì„¤ì • ì „ìš© ì‚¬ì´ë“œë°” ë ˆì´ì•„ì›ƒ (ì¹´í…Œê³ ë¦¬ ì§€ì›)
- **Profile, Account**: ì‹¤ì œ API ì—°ë™ (ì •ë³´ ìˆ˜ì •, ê³„ì • ê´€ë¦¬)
- **Appearance**: í…Œë§ˆ ì„¤ì • (Light/Dark/System) - `next-themes` íŒ¨í‚¤ì§€ ì‚¬ìš©
- **Security**: Keycloak Account Console ë§í¬ ì œê³µ
- **Billing, Plans, Emails, Applications, Notifications**: **UI ì „ìš© êµ¬í˜„** (ë°±ì—”ë“œ ì—°ë™ ì—†ìŒ, Mock ë°ì´í„° ì‚¬ìš©)

### ì œì™¸
- ì‹¤ì œ ê²°ì œ ì²˜ë¦¬ (PG ì—°ë™)
- ì™¸ë¶€ ì•± ì‹¤ì œ OAuth ì—°ë™
- ì–¸ì–´ ì„¤ì • (ë‹¤êµ­ì–´ ì§€ì› ë¯¸í¬í•¨)
- ë³µì¡í•œ ê¶Œí•œ ê´€ë¦¬
- Keycloak ë‚´ì¥ ê¸°ëŠ¥ (ë¹„ë°€ë²ˆí˜¸ ë³€ê²½, 2FA ë“±) - Keycloak Console ì‚¬ìš©

---

## ê¸°ìˆ  ìš”êµ¬ì‚¬í•­

### íŒ¨í‚¤ì§€ ì˜ì¡´ì„±

```bash
pnpm add next-themes
```

### FSD êµ¬ì¡°

```
web/
â”œâ”€â”€ app/settings/                    # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx                   # SettingsLayout ì ìš©
â”‚   â”œâ”€â”€ page.tsx                     # redirect to /settings/profile
â”‚   â”œâ”€â”€ profile/page.tsx
â”‚   â”œâ”€â”€ account/page.tsx
â”‚   â”œâ”€â”€ appearance/page.tsx
â”‚   â”œâ”€â”€ notifications/page.tsx
â”‚   â”œâ”€â”€ billing/page.tsx
â”‚   â”œâ”€â”€ emails/page.tsx
â”‚   â””â”€â”€ applications/page.tsx
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ features/settings/           # ğŸ†• Settings ê´€ë ¨ ê¸°ëŠ¥
â”‚   â”‚   â”œâ”€â”€ profile-form/
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/profile-form.tsx
â”‚   â”‚   â”‚   â””â”€â”€ model/schema.ts
â”‚   â”‚   â”œâ”€â”€ account-form/
â”‚   â”‚   â”‚   â””â”€â”€ ui/account-form.tsx
â”‚   â”‚   â”œâ”€â”€ appearance-form/
â”‚   â”‚   â”‚   â””â”€â”€ ui/appearance-form.tsx
â”‚   â”‚   â”œâ”€â”€ billing-info/
â”‚   â”‚   â”‚   â””â”€â”€ ui/billing-info.tsx   # UI Only (Mock)
â”‚   â”‚   â””â”€â”€ applications-list/
â”‚   â”‚       â””â”€â”€ ui/applications-list.tsx # UI Only (Mock)
â”‚   â”‚
â”‚   â”œâ”€â”€ widgets/layout/
â”‚   â”‚   â””â”€â”€ settings-sidebar.tsx     # ğŸ†• ì„¤ì • ì „ìš© ì‚¬ì´ë“œë°”
â”‚   â”‚
â”‚   â””â”€â”€ pages/settings/              # FSD page components
â”‚       â”œâ”€â”€ profile-page.tsx
â”‚       â”œâ”€â”€ account-page.tsx
â”‚       â”œâ”€â”€ appearance-page.tsx
â”‚       â”œâ”€â”€ notifications-page.tsx
â”‚       â”œâ”€â”€ billing-page.tsx
â”‚       â”œâ”€â”€ emails-page.tsx
â”‚       â””â”€â”€ applications-page.tsx
```

### í…Œë§ˆ ì„¤ì • êµ¬í˜„

```typescript
// app/layout.tsx (root)
import { ThemeProvider } from "next-themes";

export default function RootLayout({ children }) {
  return (
    <html lang="ko" suppressHydrationWarning>
      <body>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          {children}
        </ThemeProvider>
      </body>
    </html>
  );
}
```

### ë°ì´í„° ëª¨ë¸

```typescript
// Profile (API ì—°ë™)
interface UserProfile {
  name: string;
  username: string;
  email: string;
  bio?: string;
  urls?: string[];
  avatar_url?: string;
}

// Notifications (UI Only - localStorage)
interface NotificationSettings {
  communication_emails: boolean;
  marketing_emails: boolean;
  social_emails: boolean;
  security_emails: boolean;
}

// Theme (localStorage via next-themes)
type Theme = "light" | "dark" | "system";
```

### API ì—”ë“œí¬ì¸íŠ¸

| Method | Endpoint | ì„¤ëª… | ìƒíƒœ |
|--------|----------|------|------|
| GET | `/api/v1/auth/me` | í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ | êµ¬í˜„ë¨ |
| PUT | `/api/v1/auth/me` | í”„ë¡œí•„ ì •ë³´ ìˆ˜ì • | êµ¬í˜„ í•„ìš” |
| DELETE | `/api/v1/auth/me` | ê³„ì • ì‚­ì œ | êµ¬í˜„ í•„ìš” |

---

## ìŠ¤í† ë¦¬ ë¶„í•´

| Story | ì œëª© | ì˜ˆìƒ | ìš°ì„ ìˆœìœ„ |
|-------|------|------|----------|
| 30.1 | Settings ë ˆì´ì•„ì›ƒ ë° ë¼ìš°íŒ… êµ¬ì¡° | 0.5ì¼ | P0 |
| 30.2 | User Settings (Profile, Account) êµ¬í˜„ | 1ì¼ | P0 |
| 30.3 | Appearance (í…Œë§ˆ ì„¤ì •) êµ¬í˜„ | 0.5ì¼ | P0 |
| 30.4 | Access (Billing, Emails, Security) UI êµ¬í˜„ | 1ì¼ | P1 |
| 30.5 | Integrations (Applications) UI êµ¬í˜„ | 0.5ì¼ | P1 |

---

## ìˆ˜ìš© ê¸°ì¤€

### ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­
- [ ] ì‚¬ìš©ì ë“œë¡­ë‹¤ìš´ì—ì„œ Settingsë¥¼ í´ë¦­í•˜ë©´ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•´ì•¼ í•œë‹¤.
- [ ] ì„¤ì • í˜ì´ì§€ ì‚¬ì´ë“œë°”ê°€ ì¹´í…Œê³ ë¦¬ë³„ë¡œ êµ¬ë¶„ë˜ì–´ì•¼ í•œë‹¤.
- [ ] í”„ë¡œí•„ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ê³  ì €ì¥í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
- [ ] ë°˜ì‘í˜• ë””ìì¸ì´ ì ìš©ë˜ì–´ ëª¨ë°”ì¼ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•´ì•¼ í•œë‹¤.
- [ ] Security ë©”ë‰´ í´ë¦­ ì‹œ Keycloak Account Consoleë¡œ ì´ë™í•´ì•¼ í•œë‹¤.

### UI/UX ìš”êµ¬ì‚¬í•­
- [ ] GitHub Settingsì™€ ìœ ì‚¬í•œ ë ˆì´ì•„ì›ƒ ë° ìŠ¤íƒ€ì¼ì„ ì œê³µí•´ì•¼ í•œë‹¤.
- [ ] í¼ ì…ë ¥ ì‹œ ìœ íš¨ì„± ê²€ì‚¬(Zod)ê°€ ë™ì‘í•´ì•¼ í•œë‹¤.
- [ ] ì €ì¥ ì„±ê³µ/ì‹¤íŒ¨ ì‹œ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•´ì•¼ í•œë‹¤.
- [ ] í…Œë§ˆ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë°˜ì˜ë˜ì–´ì•¼ í•œë‹¤ (ìƒˆë¡œê³ ì¹¨ ë¶ˆí•„ìš”).

### ê¸°ìˆ  ìš”êµ¬ì‚¬í•­
- [ ] `next-themes`ë¥¼ ì‚¬ìš©í•˜ì—¬ í…Œë§ˆ ì„¤ì •ì„ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- [ ] FSD ì•„í‚¤í…ì²˜ë¥¼ ì¤€ìˆ˜í•´ì•¼ í•œë‹¤.
- [ ] TanStack Queryë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ìƒíƒœë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.
