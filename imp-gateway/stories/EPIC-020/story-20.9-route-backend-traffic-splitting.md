# Story 20.9: Route-Backend ì—°ê²° ë° Traffic Splitting UI

## ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **Story ID** | 20.9 |
| **Epic** | EPIC-020 (Route & Policy ì„¤ì •) |
| **ìš°ì„ ìˆœìœ„** | P1 |
| **ì˜ˆìƒ ê³µìˆ˜** | 0.5ì¼ |
| **ìƒíƒœ** | ğŸ”² ë¯¸ì‹œì‘ |
| **ë‹´ë‹¹ì** | - |

## ëª©í‘œ

Routeì— ì—¬ëŸ¬ Backendë¥¼ ì—°ê²°í•˜ê³  íŠ¸ë˜í”½ ê°€ì¤‘ì¹˜(weight)ë¥¼ ì„¤ì •í•˜ì—¬ ì¹´ë‚˜ë¦¬ ë°°í¬, A/B í…ŒìŠ¤íŠ¸ ë“±ì„ ì§€ì›í•œë‹¤.

## ì˜ì¡´ì„±

- Story 20.1 (Route ì—”í‹°í‹°)
- Story 20.2 (Backend ì—”í‹°í‹°)
- Story 20.5 (Route CRUD UI)

## ìš”êµ¬ì‚¬í•­

### ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

1. **ë‹¤ì¤‘ Backend ì—°ê²°**
   - Routeì— ì—¬ëŸ¬ Backend ì¶”ê°€ ê°€ëŠ¥
   - ê° Backendì— weight(ê°€ì¤‘ì¹˜) ì„¤ì •
   - weight í•©ê³„ê°€ 100%ê°€ ë˜ë„ë¡ ìë™/ìˆ˜ë™ ì¡°ì •

2. **Traffic Splitting UI**
   - ìŠ¬ë¼ì´ë” ë˜ëŠ” ì…ë ¥ í•„ë“œë¡œ weight ì¡°ì •
   - ì‹¤ì‹œê°„ ë¹„ìœ¨ ì‹œê°í™” (íŒŒì´ ì°¨íŠ¸ ë˜ëŠ” ë°” ì°¨íŠ¸)
   - weight ë³€ê²½ ì‹œ ë¯¸ë¦¬ë³´ê¸°

3. **ì‚¬ìš© ì‚¬ë¡€ ì§€ì›**
   - ì¹´ë‚˜ë¦¬ ë°°í¬: 90% stable, 10% canary
   - Blue-Green: 100% blue ë˜ëŠ” 100% green
   - A/B í…ŒìŠ¤íŠ¸: 50/50 ë¶„ë°°

4. **ê²€ì¦**
   - weight í•©ê³„ 100% ê²€ì¦
   - ìµœì†Œ 1ê°œ Backend í•„ìˆ˜
   - weight 0~100 ë²”ìœ„ ê²€ì¦

### ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

- weight ë³€ê²½ ì‹œ ì¦‰ì‹œ ë°˜ì˜
- ì§ê´€ì ì¸ ë“œë˜ê·¸ ì•¤ ë“œë¡­ UI (ì„ íƒ)
- ë³€ê²½ ì „ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸

## ê¸°ìˆ  ìƒì„¸

### BackendRef ë°ì´í„° ëª¨ë¸

```typescript
interface BackendRef {
  backend_id: string;
  weight: number;  // 0-100, í•©ê³„ 100
}

interface Route {
  // ...
  backend_refs: BackendRef[];
}
```

### Traffic Splitting UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Targets                                        [+ Add Backend]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ api-v1-backend                                                   â”‚   â”‚
â”‚  â”‚ https â€¢ 3 endpoints                                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚ Weight: [============================90%==========] 90%   [Ã—]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ api-v2-backend (canary)                                          â”‚   â”‚
â”‚  â”‚ https â€¢ 2 endpoints                                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚ Weight: [===10%=======================================] 10%   [Ã—]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Total: 100%  âœ“                                                         â”‚
â”‚                                                                         â”‚
â”‚  Quick Presets:                                                         â”‚
â”‚  [Canary 90/10] [Blue-Green 100/0] [A/B 50/50] [Equal Split]           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Traffic Distribution ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Traffic Distribution                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â”‚                    â”‚  â”‚
â”‚  â”‚         api-v1-backend (90%)         â”‚v2(10%)â”‚                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚  Estimated requests (based on 1000 req/min):                            â”‚
â”‚  â€¢ api-v1-backend: ~900 req/min                                         â”‚
â”‚  â€¢ api-v2-backend: ~100 req/min                                         â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### êµ¬í˜„ ìœ„ì¹˜

```
web/src/features/route/
â”œâ”€â”€ update-route/
â”‚   â””â”€â”€ ui/
â”‚       â”œâ”€â”€ backend-refs-editor.tsx      # Backend ëª©ë¡ í¸ì§‘
â”‚       â”œâ”€â”€ traffic-weight-slider.tsx    # Weight ìŠ¬ë¼ì´ë”
â”‚       â””â”€â”€ traffic-distribution-chart.tsx # ë¶„ë°° ì‹œê°í™”
â””â”€â”€ create-route/
    â””â”€â”€ ui/
        â””â”€â”€ backend-refs-editor.tsx      # ì¬ì‚¬ìš©
```

### API ìš”ì²­

```typescript
// Route ì—…ë°ì´íŠ¸ ì‹œ backend_refs í¬í•¨
await updateRoute.mutateAsync({
  id: routeId,
  backend_refs: [
    { backend_id: 'backend-1', weight: 90 },
    { backend_id: 'backend-2', weight: 10 },
  ],
});
```

## ìˆ˜ìš© ê¸°ì¤€

- [ ] Routeì— ì—¬ëŸ¬ Backendë¥¼ ì—°ê²°í•  ìˆ˜ ìˆë‹¤
- [ ] ê° Backendì— weightë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
- [ ] weight í•©ê³„ê°€ 100%ì¸ì§€ ê²€ì¦ëœë‹¤
- [ ] Quick Presetìœ¼ë¡œ ë¹ ë¥´ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
- [ ] Traffic ë¶„ë°°ê°€ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œëœë‹¤
- [ ] Backend ì¶”ê°€/ì œê±°ê°€ ê°€ëŠ¥í•˜ë‹¤

## ì°¸ì¡°

- Gateway API HTTPRoute BackendRef: https://gateway-api.sigs.k8s.io/reference/spec/#gateway.networking.k8s.io/v1.HTTPBackendRef
- ì¹´ë‚˜ë¦¬ ë°°í¬ íŒ¨í„´
- Story 20.5 (Route CRUD UI)
